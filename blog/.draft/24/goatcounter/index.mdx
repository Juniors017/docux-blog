---
title: "GoatCounter : analytics respectueux de la vie privée pour Docusaurus"
description: "Découverte de GoatCounter (open source, sans cookies), ses options essentielles et 3 façons simples de l’intégrer à un site Docusaurus (y compris le suivi des changements de page en SPA)."
authors: [docux]
tags: [analytics, goatcounter, docusaurus, privacy]
image: /img/docusaurus-social-card.webp
---

## Pourquoi GoatCounter ?

GoatCounter est un outil d’analytics open source, léger et respectueux de la vie privée.
Il ne dépose pas de cookies, ne piste pas les individus, et fournit des statistiques suffisantes
pour comprendre l’usage réel de votre site (pages vues, référents, appareils, etc.).

- Open source (AGPL) et auto‑hégeable, ou service hébergé prêt à l’emploi.
- Sans cookies et conforme aux réglementations de confidentialité dans la plupart des cas.
- Script minuscule (~3–7 KB gzippé) et rapide.
- API simple pour compter manuellement des vues ou des événements.

Site officiel: https://www.goatcounter.com/ — Documentation: https://www.goatcounter.com/help

---

## Les bases: insérer le script

La méthode minimale (hébergement géré par GoatCounter) consiste à ajouter ce script
sur vos pages:

```html
<script
	data-goatcounter="https://VOTRE_NOM.goatcounter.com/count"
	async
	src="https://gc.zgo.at/count.js"
></script>
```

Pour un GoatCounter auto‑hébergé, l’attribut `data-goatcounter` doit pointer vers votre endpoint `/count` :

```html
<script
	data-goatcounter="https://stats.mondomaine.tld/count"
	async
	src="https://stats.mondomaine.tld/count.js"
></script>
```

Astuce noscript (compte une vue même si JS est désactivé) :

```html
<noscript>
	<img src="https://VOTRE_NOM.goatcounter.com/count?p=/" alt="" />
</noscript>
```

---

## Options essentielles (d’après la doc)

Les options s’utilisent soit via un objet global `window.goatcounter` avant de charger le script,
soit via l’attribut `data-goatcounter` du tag `<script>`.

- `data-goatcounter`: URL de l’endpoint de comptage (ex: `https://abc.goatcounter.com/count`).
- `window.goatcounter.no_onload` (bool): n’effectue pas le comptage automatique au chargement.
	Utile pour les sites SPA (comme Docusaurus) afin d’appeler manuellement `count()` à chaque changement de route.
- `window.goatcounter.endpoint` (string): définit explicitement l’endpoint de comptage si vous n’utilisez pas `data-goatcounter`.
- `window.goatcounter.allow_local` (bool): autorise (ou non) les comptages en local (par défaut, local est ignoré).
- `window.goatcounter.path` (function): personnalise le chemin comptabilisé (inclure query/hash si souhaité).
- `window.goatcounter.count({ ... })`: API JS pour compter manuellement une page vue ou un événement.
	- `path`: chemin à comptabiliser (ex: `"/docs/intro"`).
	- `title`: titre de la page/événement.
	- `referrer`: référent à utiliser.
	- `event: true` pour enregistrer un événement (clic CTA, etc.).

Exemple d’initialisation avant le script (SPA) :

```html
<script>
	window.goatcounter = {
		no_onload: true,               // on comptera manuellement sur chaque navigation
		// endpoint: 'https://VOTRE_NOM.goatcounter.com/count', // optionnel si vous utilisez data-goatcounter
		// allow_local: false,
		// path: (p) => location.pathname + location.search + location.hash,
	};
</script>
<script
	data-goatcounter="https://VOTRE_NOM.goatcounter.com/count"
	async
	src="https://gc.zgo.at/count.js"
></script>
```

---

## Intégration avec Docusaurus (3 approches)

### 1) Ajout basique via `docusaurus.config.js`

Pour un site statique simple (sans suivi des changements de route),
ajoutez le script dans `docusaurus.config.js` (seulement en production) :

```js
// docusaurus.config.js
const isProd = process.env.NODE_ENV === 'production';

module.exports = {
	// ...
	scripts: isProd
		? [
				// (Optionnel) éviter le double comptage en SPA si vous utilisez la méthode 2/3
				{ content: 'window.goatcounter = { no_onload: true };' },
				{
					src: 'https://gc.zgo.at/count.js',
					async: true,
					'data-goatcounter': 'https://VOTRE_NOM.goatcounter.com/count',
				},
			]
		: [],
};
```

Avantages: simple et immédiat. Limite: ne compte que le chargement initial; en SPA, les changements de page client‑side ne sont pas comptés automatiquement.

### 2) Suivi SPA minimal avec un « client module »

Docusaurus permet d’exécuter du JS à chaque changement de route via `onRouteDidUpdate`.
Créez un fichier `src/goatcounter.js` :

```js
// src/goatcounter.js
export function onRouteDidUpdate({ location }) {
	if (typeof window === 'undefined') return;
	const gc = window.goatcounter;
	if (!gc || typeof gc.count !== 'function') return;

	// chemin complet (inclure query/hash si utile)
	const path = location.pathname + location.search + location.hash;
	gc.count({ path, title: document.title });
}
```

Puis référencez ce module côté client dans `docusaurus.config.js` :

```js
// docusaurus.config.js
const isProd = process.env.NODE_ENV === 'production';

module.exports = {
	// ...
	scripts: isProd
		? [
				{ content: 'window.goatcounter = { no_onload: true };' },
				{
					src: 'https://gc.zgo.at/count.js',
					async: true,
					'data-goatcounter': 'https://VOTRE_NOM.goatcounter.com/count',
				},
			]
		: [],
	clientModules: [require.resolve('./src/goatcounter.js')],
};
```

Résultat: la première vue et toutes les navigations internes sont comptées proprement.

### 3) Petit plugin Docusaurus (optionnel, plus structuré)

Si vous préférez encapsuler la logique, créez un mini‑plugin qui injecte le script et gère les navigations.
Conceptuellement, il expose `getClientModules()` et un module client avec `onRouteDidUpdate`.
Cela facilite la réutilisation (multi‑projets) et les options (endpoint, allow_local, etc.).

Exemple d’API côté config (idée) :

```js
// docusaurus.config.js
plugins: [
	[
		require.resolve('./plugins/goatcounter'),
		{
			endpoint: 'https://VOTRE_NOM.goatcounter.com/count',
			no_onload: true,
			allow_local: false,
		},
	],
],
```

---

## Événements personnalisés (clics, CTA, etc.)

Vous pouvez aussi compter des événements (en plus des pages vues) :

```js
// Exemple: clic sur un bouton d’inscription
window.goatcounter?.count({
	path: '/event/signup-cta',
	title: 'Signup CTA click',
	event: true,
});
```

Bonnes pratiques:
- Préfixez les événements avec `/event/` ou un schéma clair.
- Évitez d’envoyer des données personnelles (PII).
- Throttle/dédupliquez si besoin côté UI pour éviter le spam.

---

## Auto‑hébergement vs service hébergé

- Service hébergé: démarrez en quelques minutes, pas d’infrastructure à gérer.
- Auto‑hébergement: contrôle total des données, custom domains/CDN; nécessite de déployer l’app GoatCounter et d’exposer `/count.js` et `/count`.

Dans les deux cas, l’intégration côté Docusaurus reste identique (seule l’URL change).

---

## Vérifier que tout fonctionne

1) Lancez le site en mode production (build + serve) pour tester les scripts conditionnels.
2) Ouvrez la console du navigateur: aucun message d’erreur lié à GoatCounter.
3) Naviguez entre plusieurs pages: vous devriez voir les hits arriver sur votre tableau de bord GoatCounter.
4) Testez un événement personnalisé (voir section ci‑dessus) et validez son apparition.

Note: par défaut, GoatCounter ignore l’environnement local; activez `allow_local` si vous voulez tester sans déployer.

---

## Récap’ rapide

- Script minimal: `data-goatcounter` + `count.js`.
- Docusaurus = SPA: activez `no_onload` et appelez `goatcounter.count()` sur chaque navigation (client module ou plugin).
- Évitez les doublons (une vue par navigation) et gardez les événements distincts.
- Évitez toute donnée personnelle; GoatCounter est pensé « privacy‑first ».

Besoin d’un exemple prêt à copier-coller dans votre projet Docusaurus? Utilisez la méthode « client module » (section 2): elle est simple, robuste, et extensible.

