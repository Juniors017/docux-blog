"use strict";(globalThis.webpackChunkdocux_blog=globalThis.webpackChunkdocux_blog||[]).push([[3067],{2816:e=>{e.exports=JSON.parse('{"permalink":"/blog/goatcounter-json-views","editUrl":"https://github.com/Juniors017/docux-blog/tree/main/blog/2025/10/26/counterpage/index.mdx","source":"@site/blog/2025/10/26/counterpage/index.mdx","title":"GoatCountViews Component","description":"Add a clean view counter in Docusaurus with GoatCounter, the JSON API, and an explicit per-post path (path={metadata.permalink}).","date":"2025-10-26T00:00:00.000Z","tags":[{"inline":true,"label":"goatcounter","permalink":"/blog/tags/goatcounter"},{"inline":true,"label":"analytics","permalink":"/blog/tags/analytics"},{"inline":true,"label":"SEO","permalink":"/blog/tags/seo"},{"inline":true,"label":"views","permalink":"/blog/tags/views"}],"readingTime":2.96,"hasTruncateMarker":true,"authors":[{"name":"Docux","title":"Curious explorer, a bit of a mad experimenter, and a bit of a contributor.","url":"https://docuxlab.com","page":{"permalink":"/blog/authors/docux"},"socials":{"github":"https://github.com/Juniors017","bluesky":"https://bsky.app/profile/docuxlab.com"},"bio":"Curious explorer, a bit of a mad experimenter, and a bit of a contributor for Docusaurus. I love creating tools to improve productivity and user experience.\\nAnd sharing my discoveries with the community.\\n","imageURL":"https://avatars.githubusercontent.com/u/97809069?v=4","key":"docux"}],"frontMatter":{"title":"GoatCountViews Component","description":"Add a clean view counter in Docusaurus with GoatCounter, the JSON API, and an explicit per-post path (path={metadata.permalink}).","slug":"goatcounter-json-views","schemaTypes":["HowTo","BlogPosting"],"image":"/img/goatcounterviews.webp","authors":["docux"],"mainTag":"analytics","tags":["goatcounter","analytics","SEO","views"],"date":"2025-10-26T00:00:00.000Z","difficulty":"Beginner-Intermediate","estimatedCost":"Free","tool":["GoatCounter","Docusaurus","React","MDX"],"supply":["Node.js","Docusaurus","React","Hooks"],"genre":"Technical Tutorial","inLanguage":"en","category":"Frontend","keywords":["goatcounter","view counter","analytics","json api","docusaurus","mdx","react"],"hide_table_of_contents":false,"series":"SEO & Analytics","copyrightYear":2025,"copyrightHolder":"Docux"},"unlisted":false,"prevItem":{"title":"Creating Custom 404 Page","permalink":"/blog/404-custom-page-tutorial"},"nextItem":{"title":"GoatCounter analytics","permalink":"/blog/goatcounter"}}')},6062:(e,n,t)=>{t.d(n,{A:()=>o});let o=t.p+"assets/images/vuedesviewgoat-de76646c2769b4061f8924a9da5343f7.webp"},6929:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>l});var o=t(2816),s=t(4848),a=t(8453);let i={title:"GoatCountViews Component",description:"Add a clean view counter in Docusaurus with GoatCounter, the JSON API, and an explicit per-post path (path={metadata.permalink}).",slug:"goatcounter-json-views",schemaTypes:["HowTo","BlogPosting"],image:"/img/goatcounterviews.webp",authors:["docux"],mainTag:"analytics",tags:["goatcounter","analytics","SEO","views"],date:new Date("2025-10-26T00:00:00.000Z"),difficulty:"Beginner-Intermediate",estimatedCost:"Free",tool:["GoatCounter","Docusaurus","React","MDX"],supply:["Node.js","Docusaurus","React","Hooks"],genre:"Technical Tutorial",inLanguage:"en",category:"Frontend",keywords:["goatcounter","view counter","analytics","json api","docusaurus","mdx","react"],hide_table_of_contents:!1,series:"SEO & Analytics",copyrightYear:2025,copyrightHolder:"Docux"},r=void 0,c={authorsImageUrls:[void 0]},l=[{value:"Why I chose the JSON API instead of <code>visit_count()</code>",id:"why-i-chose-the-json-api-instead-of-visit_count",level:2},{value:"Load GoatCounter globally",id:"load-goatcounter-globally",level:2},{value:"React component: JSON fetch + accessible rendering",id:"react-component-json-fetch--accessible-rendering",level:2},{value:"The component",id:"the-component",level:3},{value:"Logic",id:"logic",level:3},{value:"Full component code",id:"full-component-code",level:2},{value:"Files structure",id:"files-structure",level:3},{value:"Code",id:"code",level:3},{value:"Usage in an MDX page",id:"usage-in-an-mdx-page",level:2},{value:"In a standard post",id:"in-a-standard-post",level:3},{value:"Post list",id:"post-list",level:2},{value:"On a listing page (e.g., Blog)",id:"on-a-listing-page-eg-blog",level:3}];function d(e){let n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components},{File:o,Folder:i,ImageOnClick:r,Snippet:c,Trees:l}=n;return o||h("File",!0),i||h("Folder",!0),r||h("ImageOnClick",!0),c||h("Snippet",!0),l||h("Trees",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("center",{children:(0,s.jsxs)("div",{children:[(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://github.com/Juniors017",children:(0,s.jsx)(n.img,{src:"https://img.shields.io/badge/Developer-Docux-green.svg",alt:"Developer"})}),"\n",(0,s.jsx)(n.a,{href:"https://github.com/Juniors017",children:(0,s.jsx)(n.img,{src:"https://img.shields.io/badge/Development-passed-green.svg",alt:"Development"})}),"\n",(0,s.jsx)(n.a,{href:"https://opensource.org/licenses/MIT",children:(0,s.jsx)(n.img,{src:"https://img.shields.io/badge/License-MIT-yellow.svg",alt:"License: MIT"})}),"\n",(0,s.jsx)(n.a,{href:"https://github.com/Juniors017",children:(0,s.jsx)(n.img,{src:"https://img.shields.io/badge/AI-55%25-blue.svg",alt:"AI 65%"})})]}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(9613).A+"",width:"1175",height:"679"})})]})}),"\n",(0,s.jsxs)(n.p,{children:["After adding ",(0,s.jsx)(n.a,{href:"https://www.goatcounter.com/",children:"Goatcounter"})," to my blog, I wanted to display view counts for each page. My goals were to:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Display the number of views for a page"}),"\n",(0,s.jsx)(n.li,{children:"In the article list, show the views for each post individually"}),"\n",(0,s.jsx)(n.li,{children:'Avoid HTML injection and the "flash" of unparsed content (common when using JavaScript or the iframe)'}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"So I created this component using GoatCounter's JSON API."}),"\n",(0,s.jsxs)(n.p,{children:["Official ",(0,s.jsx)(n.a,{href:"https://www.goatcounter.com/",children:"Goatcounter"})," docs for this: ",(0,s.jsx)(n.a,{href:"https://www.goatcounter.com/help/visitor-counter",children:"View counts"})]}),"\n","\n",(0,s.jsxs)(n.h2,{id:"why-i-chose-the-json-api-instead-of-visit_count",children:["Why I chose the JSON API instead of ",(0,s.jsx)(n.code,{children:"visit_count()"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Inline ",(0,s.jsx)(n.code,{children:"<script>"})," tags aren\u2019t well supported by MDX/Docusaurus (acorn parsing errors)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"visit_count()"})," injects raw HTML, which causes a visible \u201Cflash\u201D before we can parse/format it. ",(0,s.jsx)(r,{imageUrl:"/img/vuegoatcounteriframe.webp",altText:"Flash",buttonName:"here's what flashes for 1\u20133 seconds"})]}),"\n",(0,s.jsx)(n.li,{children:"The JSON API only returns data (no HTML). We keep full control of the rendering: icon, localized formatting, accessibility, etc."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Conclusion:"})," Using JSON avoids third\u2011party HTML injection, removes the flash, and keeps the rendering fully under your control."]}),"\n",(0,s.jsx)(n.h2,{id:"load-goatcounter-globally",children:"Load GoatCounter globally"}),"\n",(0,s.jsxs)(n.p,{children:["Learn more here: ",(0,s.jsx)(n.a,{href:"/blog/goatcounter/",children:"Goatcounter Analytics"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",metastring:'"title="docusaurus.config.js"',children:"///...existing config...\nscripts: [\n	{\n		src: 'https://gc.zgo.at/count.js',\n		async: true,\n		'data-goatcounter': 'https://yourName.goatcounter.com/count',\n		crossOrigin: 'anonymous',\n	},\n],\n"})}),"\n",(0,s.jsx)(n.p,{children:"This script records visits. The JSON API is only used to read/display them."}),"\n",(0,s.jsx)(n.h2,{id:"react-component-json-fetch--accessible-rendering",children:"React component: JSON fetch + accessible rendering"}),"\n",(0,s.jsx)(n.h3,{id:"the-component",children:"The component"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Detects the base ",(0,s.jsx)(n.code,{children:"https://yourName.goatcounter.com"})," from the ",(0,s.jsx)(n.code,{children:"data-goatcounter"})," attribute injected into the page;"]}),"\n",(0,s.jsxs)(n.li,{children:["Determines the target path (prop ",(0,s.jsx)(n.code,{children:"path"})," takes precedence, otherwise it uses the current path);"]}),"\n",(0,s.jsxs)(n.li,{children:["Calls ",(0,s.jsx)(n.code,{children:"/counter/<path>.json"})," and formats according to ",(0,s.jsx)(n.code,{children:"navigator.language"}),";"]}),"\n",(0,s.jsxs)(n.li,{children:["Renders an \u201Ceyes\u201D icon (twemoji) + the number, with ",(0,s.jsx)(n.code,{children:'aria-label="views"'}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"logic",children:"Logic"}),"\n",(0,s.jsx)(n.p,{children:"On errors or blockers:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Display rule: if total views < 100 \u2192 show \u201CNew!\u201D, otherwise show the formatted number (useful for young blogs)."}),"\n",(0,s.jsxs)(n.li,{children:["If the JSON endpoint returns 404 (page never seen by ",(0,s.jsx)(n.a,{href:"https://www.goatcounter.com/",children:"Goatcounter"})," in prod), also show \u201CNew!\u201D."]}),"\n",(0,s.jsxs)(n.li,{children:["On ",(0,s.jsx)(n.code,{children:"localhost"}),", ",(0,s.jsx)(n.a,{href:"https://www.goatcounter.com/",children:"Goatcounter"})," doesn\u2019t count, but will display whatever is already stored."]}),"\n",(0,s.jsxs)(n.li,{children:["On network/ad\u2011blocker errors (JSON request fails), the fallback shows 0 in dev and nothing in prod; if the return is ",(0,s.jsx)(n.code,{children:"null"})," we render nothing."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The 100\u2011views rule can be adjusted to your needs. After a chat with a Belgian meerkat, it\u2019s true that showing low view counts can be perceived as a negative signal when the numbers are relatively small."}),"\n",(0,s.jsx)(n.h2,{id:"full-component-code",children:"Full component code"}),"\n",(0,s.jsx)(n.h3,{id:"files-structure",children:"Files structure"}),"\n",(0,s.jsx)(l,{children:(0,s.jsx)(i,{label:"src",expanded:!0,children:(0,s.jsx)(i,{label:"components",expanded:!0,children:(0,s.jsx)(i,{label:"GoatCountViews",expanded:!0,children:(0,s.jsx)(o,{label:"index.js",icon:"javascript"})})})})}),"\n",(0,s.jsx)(n.h3,{id:"code",children:"Code"}),"\n",(0,s.jsx)(c,{filename:"src/components/GoatCountViews/index.js",source:"src/components/GoatCountViews/index.js",code:"import React, {useEffect, useState} from 'react';\nimport LogoIcon from '@site/src/components/LogoIcon';\n\nexport default function GoatCounterViews({path: explicitPath}) {\n  const [text, setText] = useState(null);\n\n  useEffect(() => {\n    let done = false;\n    const controller = new AbortController();\n\n    const locale = typeof navigator !== 'undefined' && navigator.language ? navigator.language : 'en-US';\n    const format = n => new Intl.NumberFormat(locale).format(n);\n\n    const normalizePath = (p) => {\n      if (!p) return p;\n      try {\n        const u = new URL(p, location.origin);\n        return u.pathname + u.search;\n      } catch {\n        return p;\n      }\n    };\n\n    const getBase = () => {\n      const el = document.querySelector('script[data-goatcounter]');\n      const data = el?.getAttribute('data-goatcounter');\n      if (data) {\n        try {\n          const u = new URL(data);               // https://SUB.goatcounter.com/count\n          return `${u.protocol}//${u.host}`;     // https://SUB.goatcounter.com\n        } catch {}\n      }\n      return null;\n    };\n\n    const getPath = () => {\n      if (explicitPath) return normalizePath(explicitPath);\n      try {\n        const p = window.goatcounter?.get_data?.()?.p;\n        if (p) return p;\n      } catch {}\n      return location.pathname;\n    };\n\n    (async () => {\n      try {\n        const base = getBase();\n        const path = getPath();\n        if (!base || !path) throw new Error('missing base or path');\n\n        const res = await fetch(`${base}/counter/${encodeURIComponent(path)}.json`, {\n          method: 'GET',\n          mode: 'cors',\n          credentials: 'omit',\n          cache: 'no-store',\n          signal: controller.signal,\n        });\n  // 404 case: unknown path in GoatCounter -> page never seen in production\n        if (res.status === 404) {\n          const isLocal = /^(localhost|127\\.0\\.0\\.1|::1)$/i.test(location.hostname);\n            if (!done) setText('New!');\n          done = true;\n          return;\n        }\n        if (!res.ok) throw new Error(`HTTP ${res.status}`);\n          const json = await res.json();\n\n          const digits = String(json?.count ?? '').replace(/\\D/g, '');\n          if (digits) {\n            const value = Number(digits);\n            if (done) return;\n            // Rule: < 100 => \"New!\", otherwise formatted value\n            setText(value < 100 ? 'New!' : format(value));\n            done = true;\n            return;\n          }\n          throw new Error('empty count');\n      } catch (e) {\n        // Abort: do nothing\n        if (e?.name === 'AbortError') return;\n        // Other errors (network, blocking, CORS, etc.)\n        setTimeout(() => {\n          if (done) return;\n          const isLocal = /^(localhost|127\\.0\\.0\\.1|::1)$/i.test(location.hostname);\n          // In dev: show 0 for visibility; in prod: render nothing (null) when unavailable/blocked\n          setText(isLocal ? format(0) : null);\n          done = true;\n        }, 300);\n      }\n    })();\n\n    return () => {\n      done = true;\n      controller.abort();\n    };\n  }, [explicitPath]);\n\n  if (text == null) return null;\n\n  return (\n    <span aria-label=\"views\" title=\"views\">\n      <LogoIcon name=\"twemoji:eyes\" size={12} />{' '}{text}\n    </span>\n  );\n}",lang:"javascript"}),"\n",(0,s.jsx)(n.h2,{id:"usage-in-an-mdx-page",children:"Usage in an MDX page"}),"\n",(0,s.jsx)(n.h3,{id:"in-a-standard-post",children:"In a standard post"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mdx",children:'---\ntitle: "View counter"\n---\n\nSeen by: <GoatCounterViews />  meerkats\n'})}),"\n",(0,s.jsx)(n.p,{children:"The component will display the views for the current page."}),"\n",(0,s.jsx)(n.p,{children:"Seen by: 2600 meerkats"}),"\n",(0,s.jsx)(n.h2,{id:"post-list",children:"Post list"}),"\n",(0,s.jsx)(n.h3,{id:"on-a-listing-page-eg-blog",children:"On a listing page (e.g., Blog)"}),"\n",(0,s.jsxs)(n.p,{children:["If you display ",(0,s.jsx)(n.em,{children:"multiple"})," posts, you must request the counter for ",(0,s.jsx)(n.strong,{children:"each post"})," by passing its exact path. For example, in a swizzled component (header of a blog post item):"]}),"\n",(0,s.jsxs)(n.p,{children:["Provide the path ",(0,s.jsx)(n.code,{children:"path={metadata.permalink}"})," for each post"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jsx",metastring:'"title="src/theme/BlogPostItem/Header/index.js"',children:"import GoatCounterViews from '@site/src/components/GoatCountViews';\n\nexport default function BlogPostItemHeader({metadata, ...props}) {\n	return (\n		<>\n			{/* ...existing code... */}\n			<GoatCounterViews path={metadata.permalink} />\n		</>\n	);\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(6062).A+"",width:"571",height:"108"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"This way, each card shows the views of its own article, not the views of the listing page."})})]})}function u(e={}){let{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}function h(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>r});var o=t(6540);let s={},a=o.createContext(s);function i(e){let n=o.useContext(a);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),o.createElement(a.Provider,{value:n},e.children)}},9613:(e,n,t)=>{t.d(n,{A:()=>o});let o=t.p+"assets/images/goatcounterviews-d868924297b12e74d249055163810d3f.webp"}}]);